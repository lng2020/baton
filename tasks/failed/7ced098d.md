# Add image upload UI to plan mode (chat)

type: feature

Add image attachment capability to the chat/plan mode interface:

1. **Update HTML** (`frontend/index.html`):
   - Add a file input and attachment button next to the chat textarea in `.chat-input-area` (line 53-56). Add before the send button:
   ```html
   <input type="file" id="chat-image-input" accept="image/*" multiple style="display:none" />
   <button class="btn-attach" id="btn-chat-attach" title="Attach image">&#128206;</button>
   ```
   - Add an image preview area above the input area inside `chat-body`, just before `chat-input-area`:
   ```html
   <div class="chat-attachments" id="chat-attachments" style="display:none"></div>
   ```

2. **Update JavaScript** (`frontend/js/app.js`):
   - Add DOM refs for `chat-image-input`, `btn-chat-attach`, `chat-attachments`
   - Add state: `let chatPendingImages = []` (array of `{file, previewUrl, uploadedUrl, uploadedFilename}`)
   - Wire `btn-chat-attach` click to trigger `chat-image-input.click()`
   - On `chat-image-input` change: for each selected file, create an object URL preview, push to `chatPendingImages`, render preview thumbnails with remove buttons in `#chat-attachments`
   - Modify `sendMessage()` function:
     a. Before sending the chat request, upload each pending image via `POST /api/projects/{projectId}/upload` using `FormData`
     b. Collect the returned URLs/filenames
     c. Append image references to the message content (e.g., `\n\n[Attached image: /uploads/filename.png]` for each image)
     d. Include the image paths in the chat payload so the backend can pass them to Claude
     e. Clear `chatPendingImages` and hide the preview area after sending
   - In `appendMessage()`: if message contains image references, render them as `<img>` tags in the chat bubble
   - Update `saveChatState()`/`restoreChatState()` to include `chatPendingImages`
   - Update `resetChat()` to clear pending images

3. **Update CSS** (`frontend/css/style.css`):
   - Style `.btn-attach` similar to `.btn-send` but with a muted color
   - Style `.chat-attachments` as a horizontal flex row of thumbnail previews (e.g., 60x60px thumbnails with rounded corners)
   - Style remove button on each thumbnail (small X in corner)
   - Style `img` tags inside `.chat-bubble` (max-width: 100%, border-radius, cursor pointer)