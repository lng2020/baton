# Add mode toggle UI, task form, switching logic, and styles

Add a Plan/Task mode toggle to the chat section across three files:

**frontend/index.html** — Two changes inside `#chat-section`:

1. In the `.chat-header` div (line 25-30), insert a mode toggle between the `<h3>` (line 26) and `.chat-header-actions` (line 27):
```html
<div class="chat-mode-toggle">
    <button class="mode-btn active" data-mode="plan">Plan</button>
    <button class="mode-btn" data-mode="task">Task</button>
</div>
```

2. Add a task-form div as a sibling AFTER the closing `</div>` of `.chat-body` (after line 53), before the closing `</div>` of `.chat-section`:
```html
<div class="task-form" id="task-form" style="display:none">
    <div class="task-form-body">
        <input type="text" id="task-title" placeholder="Task title" maxlength="80" />
        <textarea id="task-content" rows="8" placeholder="Detailed task description..."></textarea>
        <button class="btn-submit" id="btn-task-submit">Create Task</button>
    </div>
</div>
```

**frontend/js/app.js** — Add mode switching logic:

1. Add state variable `let chatMode = 'plan';` near line 17 (after `let isStreaming = false;`)

2. Add DOM refs (after the existing chat refs around line 48):
```js
const taskForm = document.getElementById('task-form');
const taskTitle = document.getElementById('task-title');
const taskContent = document.getElementById('task-content');
const btnTaskSubmit = document.getElementById('btn-task-submit');
const modeToggleBtns = document.querySelectorAll('.mode-btn');
const chatHeaderTitle = document.querySelector('.chat-header h3');
```

3. Add mode toggle handler (after the GREETING constant, around line 50):
```js
function switchMode(mode) {
    chatMode = mode;
    modeToggleBtns.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.mode === mode);
    });
    if (mode === 'plan') {
        chatBody.style.display = '';
        taskForm.style.display = 'none';
        chatHeaderTitle.textContent = 'Agent Engineer';
        btnChatClear.style.display = '';
    } else {
        chatBody.style.display = 'none';
        taskForm.style.display = '';
        chatHeaderTitle.textContent = 'New Task';
        btnChatClear.style.display = 'none';
    }
}

modeToggleBtns.forEach(btn => {
    btn.addEventListener('click', () => switchMode(btn.dataset.mode));
});
```

4. Add `submitTask()` function:
```js
async function submitTask() {
    const title = taskTitle.value.trim();
    const content = taskContent.value.trim();
    if (!title || !content || !selectedProjectId) return;
    try {
        const res = await fetch(`/api/projects/${selectedProjectId}/tasks`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title, content }),
        });
        if (!res.ok) throw new Error(res.statusText);
        taskTitle.value = '';
        taskContent.value = '';
        loadTasks();
    } catch (err) {
        alert('Failed to create task: ' + err.message);
    }
}
```

5. Wire up event listeners (near the other chat event listeners around line 470-489):
```js
btnTaskSubmit.addEventListener('click', submitTask);
taskTitle.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
        e.preventDefault();
        submitTask();
    }
});
```

6. In the `resetChat()` function, do NOT reset chatMode or toggle visibility — preserve the current mode when switching projects. The resetChat function should keep the chat content reset but not change mode state.

**frontend/css/style.css** — Add these styles (after the existing `.chat-plan-actions` block at line 745):

```css
/* ---- Chat Mode Toggle ---- */
.chat-mode-toggle {
    display: flex;
    gap: 4px;
}
.mode-btn {
    padding: 4px 12px;
    border-radius: 12px;
    background: transparent;
    color: var(--text-secondary);
    border: none;
    cursor: pointer;
    font-size: 0.8rem;
    font-family: inherit;
    transition: background 0.15s, color 0.15s;
}
.mode-btn:hover {
    color: var(--text-primary);
}
.mode-btn.active {
    background: var(--bg-accent);
    color: #fff;
}

/* ---- Task Form ---- */
.task-form {
    display: flex;
    flex-direction: column;
    padding: 1rem;
    flex: 1;
    min-height: 0;
}
.task-form-body {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}
.task-form input,
.task-form textarea {
    background: var(--bg-primary);
    border: 1px solid var(--border);
    color: var(--text-primary);
    border-radius: 8px;
    padding: 0.75rem;
    font-family: inherit;
    font-size: 0.85rem;
    resize: vertical;
}
.task-form input:focus,
.task-form textarea:focus {
    outline: none;
    border-color: var(--accent);
}
```