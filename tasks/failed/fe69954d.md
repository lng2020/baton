# Pass images to Claude Code in chat and dispatcher

type: feature

Ensure uploaded images are passed through to Claude Code CLI so the AI can actually see them:

1. **Update chat models** (`backend/models.py`):
   - Add optional `images` field to `ChatMessage`: `images: list[str] = []` (list of file paths relative to project root)
   - Add optional `images` field to `ChatRequest` messages

2. **Update chat stream** (`backend/chat.py`):
   - Modify `chat_stream()` to accept image paths from messages
   - When building the stdin input for Claude Code, if images are present, include them. Claude Code CLI supports image input â€” check if it supports `--image` flag or if images need to be referenced in the prompt text.
   - The Claude Code CLI (`claude -p`) can accept images via the `--file` flag or by referencing local file paths. Update `_build_chat_command()` to add `--file /path/to/image` for each attached image, or include image paths in the prompt text so Claude Code's Read tool can view them.
   - Alternative approach: Since Claude Code has access to the filesystem, simply reference the image paths in the prompt text (e.g., "See attached image at: /absolute/path/to/uploads/image.png") and Claude Code will use its Read tool to view the image.

3. **Update dispatcher task execution** (`backend/agent.py`, `_execute_task` method around line 644):
   - When building the prompt (line 662-669), parse the task markdown content for image references
   - Copy referenced images from `uploads/` to the worktree so Claude Code can access them
   - Or reference them by absolute path in the prompt

4. **Update frontend chat payload** (`frontend/js/app.js`):
   - In `sendMessage()`, include the uploaded image filenames in the message payload so the backend knows which images to pass to Claude
   - Update the chat message format to include `images` array alongside `content`